<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Darcy world"><title>MySQL 执行计划详解 | Darcy Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MySQL 执行计划详解</h1><a id="logo" href="/.">Darcy Blog</a><p class="description">The more I see of the world, the more I am dissatisfied with it</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">MySQL 执行计划详解</h1><div class="post-meta">Jun 12, 2014<span> | </span><span class="category"><a href="/categories/MySQL/">MySQL</a></span></div><div class="post-content"><h3 id="执行计划概述"><a href="#执行计划概述" class="headerlink" title="执行计划概述"></a>执行计划概述</h3><p>&ensp;&ensp;MySQL 接收一条Query后,会进行SQL解析,生成语法树,接下来会生成执行计划,选择最优的执行计划进行执行,对于一条SQL,可能有多种执行计划,观察和分析执行计划可以帮助开发人员以及DBA优化SQL.</p>
<hr>
<p>With the help of EXPLAIN, you can see where you should add indexes to tables so that the statement executes faster by using indexes to find rows. You can also use EXPLAIN to check whether the optimizer joins the tables in an optimal order<a id="more"></a><br>To give a hint to the optimizer to use a join order corresponding to the order in which the tables are named in<br>a SELECT statement, begin the statement with SELECT STRAIGHT_JOIN rather than just SELECT.</p>
<hr>
<h3 id="执行计划"><a href="#执行计划" class="headerlink" title="执行计划"></a>执行计划</h3><ul>
<li>&ensp;&ensp;<strong>EXPLAIN SELECT</strong> …..</li>
<li>&ensp;&ensp;<strong>EXPLAIN EXTENDED SELECT</strong> …..<br>&ensp;&ensp;&ensp;  将执行计划”反编译”成SELECT语句,执行SHOW WARNINGS可以得到被MySQL优化器优化的查询语句.</li>
<li>&ensp;&ensp;<strong>EXPLAIN PARTITIONS SELECT</strong> …..<br>&ensp;&ensp;&ensp;   用于分区表的EXPLAIN.</li>
<li>&ensp;&ensp;<strong>DESC/DESCRIBE SELECT</strong> ……<br>&ensp;&ensp;&ensp;  MySQL中使用DESC和EXPLAIN同样的效果.<h3 id="执行计划解释"><a href="#执行计划解释" class="headerlink" title="执行计划解释"></a>执行计划解释</h3><h4 id="执行计划包含如下信息"><a href="#执行计划包含如下信息" class="headerlink" title="执行计划包含如下信息"></a>执行计划包含如下信息</h4><pre><br><code><br>+—-+————-+——-+——-+—————+——+———+——-+——+——-+<br>| id | select_type | table | type  | possible_keys | key  | key_len | ref   | rows | Extra |<br>+—-+————-+——-+——-+—————+——+———+——-+——+——-+<br></code><br></pre><h4 id="id"><a href="#id" class="headerlink" title="id:"></a><strong>id</strong>:</h4><h5 id="ensp-ensp-ensp-包含一组数字-表示查询在执行中的select子句或者操作表的顺序"><a href="#ensp-ensp-ensp-包含一组数字-表示查询在执行中的select子句或者操作表的顺序" class="headerlink" title="&ensp;&ensp;&ensp;包含一组数字,表示查询在执行中的select子句或者操作表的顺序."></a>&ensp;&ensp;&ensp;包含一组数字,表示查询在执行中的select子句或者操作表的顺序.</h5></li>
<li>id相同,执行顺序由上至下     </li>
<li>子查询中,id的序号会递增,id越大优先级越高,越先被执行.    </li>
<li>id如果相同,可以认为是一个group,从上往下顺序执行;在所有的group中,id值越大,优先级越高,越先被执行   <h4 id="select-type-表示查询中每个SELECT子句的类型"><a href="#select-type-表示查询中每个SELECT子句的类型" class="headerlink" title="select_type:  表示查询中每个SELECT子句的类型."></a>select_type:  表示查询中每个SELECT子句的类型.</h4><pre>
<code>
+------+--------------+
| id   | select_type  |
+------+--------------+
| 1    | SIMPLE       |
| 2    | PRIMARY      |
| 3    | SUBQUERY     |
| 4    | DERIVED      |
| 5    | UNION        |
| 6    | UNION RESULT |
+------+--------------+
</code>
</pre></li>
<li>SIMPLE :        查询中不包含子查询或者UNION.</li>
<li>PRIMARY:        查询中包含任何复杂的子部分,最外层查询被标记为PRIMARY.</li>
<li>SUBQUERY:       在SELECT或者WHERE列表中包含了子查询,该子查询被标记为SUBQUERY.</li>
<li>DERIVED:        在FROM列表中包含的子查询被标记为DERIVED.</li>
<li>UNION:          若第二个SELECT出现在UNION之后,则被标记为UNION;若UNION包含在FROM子句的子查询中,则被标记为DERIVED.</li>
<li>UNION RESULT    从UNION表获取结果的SELECT被标记为UNION RESULT.</li>
</ul>
<h4 id="type"><a href="#type" class="headerlink" title="type:"></a><strong>type</strong>:</h4><h5 id="ensp-ensp-ensp-表示MySQL执行查询时是如何获取所需行的-又称”访问类型”"><a href="#ensp-ensp-ensp-表示MySQL执行查询时是如何获取所需行的-又称”访问类型”" class="headerlink" title="&ensp;&ensp;&ensp;表示MySQL执行查询时是如何获取所需行的,又称”访问类型”"></a>&ensp;&ensp;&ensp;表示MySQL执行查询时是如何获取所需行的,又称”访问类型”</h5><p><pre><br><code><br>+—–+——-+——-+—–+——–+————–+——+<br>| ALL | index | range | ref | eq_ref | const,system | NULL |<br>+—–+——-+——-+—–+——–+————–+——+<br></code><br></pre></p>
<h5 id="从左至右-执行效率右最差到最好"><a href="#从左至右-执行效率右最差到最好" class="headerlink" title="从左至右,执行效率右最差到最好"></a><em>从左至右,执行效率右最差到最好</em></h5><ul>
<li>ALL:            Full Table Scan,MySQL扫描全表以找到匹配的行.</li>
<li>index:          Full Index Scan,index与ALL的区别在于index只遍历索引树</li>
<li>range:          索引范围扫描,对索引的扫描开始于某一点,返回匹配值域的行.</li>
<li>ref:            非唯一性索引扫描,返回匹配某个值的所有.</li>
<li>eq_ref:         唯一性索引扫描,对于某个索引键,表中只有一条记录与之匹配,常见于主键或者唯一索引查询.</li>
<li>const,system:   当MySQL优化部分查询,并转换为一个常量时,使用这些类型访问.如将主键置与where列表中,MySQL就能将该查询替换为一个常量.需要注意的是system是const的特殊类型,当查询的表只有一行的情况下使用system.</li>
<li><p>NULL:           MySQL在优化过程中分解语句,执行时不用访问表或者索引.</p>
<h4 id="possible-keys"><a href="#possible-keys" class="headerlink" title="possible_keys:"></a><strong>possible_keys</strong>:</h4><h5 id="ensp-ensp-ensp-MySQL能够使用那个索引找到匹配的行-查询涉及到字段上若存在索引-则该索引将被列出-但是不一定被查询使用到"><a href="#ensp-ensp-ensp-MySQL能够使用那个索引找到匹配的行-查询涉及到字段上若存在索引-则该索引将被列出-但是不一定被查询使用到" class="headerlink" title="&ensp;&ensp;&ensp;MySQL能够使用那个索引找到匹配的行,查询涉及到字段上若存在索引,则该索引将被列出,但是不一定被查询使用到."></a>&ensp;&ensp;&ensp;MySQL能够使用那个索引找到匹配的行,查询涉及到字段上若存在索引,则该索引将被列出,但是不一定被查询使用到.</h5><h4 id="key"><a href="#key" class="headerlink" title="key:"></a><strong>key</strong>:</h4><h5 id="ensp-ensp-ensp-MySQL在查询中实际使用的索引-若没有使用索引-将显示为NULL-若使用了覆盖索引-该索引仅出现在key列表中"><a href="#ensp-ensp-ensp-MySQL在查询中实际使用的索引-若没有使用索引-将显示为NULL-若使用了覆盖索引-该索引仅出现在key列表中" class="headerlink" title="&ensp;&ensp;&ensp;MySQL在查询中实际使用的索引,若没有使用索引,将显示为NULL.若使用了覆盖索引,该索引仅出现在key列表中."></a>&ensp;&ensp;&ensp;MySQL在查询中实际使用的索引,若没有使用索引,将显示为NULL.若使用了覆盖索引,该索引仅出现在key列表中.</h5><h4 id="key-len"><a href="#key-len" class="headerlink" title="key_len:"></a><strong>key_len</strong>:</h4><h5 id="ensp-ensp-ensp-表示索引中使用的字节数-可以通过该列计算查询中使用索引的长度-key-len-显示的值是索引字段的最大可能长度-并非使用长度-key-len是跟进表定义计算得到的-而不是检索表的实际内容得到的"><a href="#ensp-ensp-ensp-表示索引中使用的字节数-可以通过该列计算查询中使用索引的长度-key-len-显示的值是索引字段的最大可能长度-并非使用长度-key-len是跟进表定义计算得到的-而不是检索表的实际内容得到的" class="headerlink" title="&ensp;&ensp;&ensp;表示索引中使用的字节数,可以通过该列计算查询中使用索引的长度.(key_len 显示的值是索引字段的最大可能长度,并非使用长度,key_len是跟进表定义计算得到的,而不是检索表的实际内容得到的)"></a>&ensp;&ensp;&ensp;表示索引中使用的字节数,可以通过该列计算查询中使用索引的长度.(key_len 显示的值是索引字段的最大可能长度,并非使用长度,key_len是跟进表定义计算得到的,而不是检索表的实际内容得到的)</h5><h4 id="ref"><a href="#ref" class="headerlink" title="ref:"></a><strong>ref</strong>:</h4><h5 id="ensp-ensp-ensp-表示上述表的连接匹配条件-既那些列或者常量用于查询索引列上的值"><a href="#ensp-ensp-ensp-表示上述表的连接匹配条件-既那些列或者常量用于查询索引列上的值" class="headerlink" title="&ensp;&ensp;&ensp;表示上述表的连接匹配条件,既那些列或者常量用于查询索引列上的值."></a>&ensp;&ensp;&ensp;表示上述表的连接匹配条件,既那些列或者常量用于查询索引列上的值.</h5><h4 id="row"><a href="#row" class="headerlink" title="row:"></a><strong>row</strong>:</h4><h5 id="ensp-ensp-ensp-表示MySQL根据表的统计信息及索引选用情况-估算找到匹配行所需要读取的行数"><a href="#ensp-ensp-ensp-表示MySQL根据表的统计信息及索引选用情况-估算找到匹配行所需要读取的行数" class="headerlink" title="&ensp;&ensp;&ensp;表示MySQL根据表的统计信息及索引选用情况,估算找到匹配行所需要读取的行数."></a>&ensp;&ensp;&ensp;表示MySQL根据表的统计信息及索引选用情况,估算找到匹配行所需要读取的行数.</h5><h4 id="Extra"><a href="#Extra" class="headerlink" title="Extra:"></a><strong>Extra</strong>:</h4><h5 id="ensp-ensp-ensp-包含不适合在其他列显示但是十分重要的额外消息"><a href="#ensp-ensp-ensp-包含不适合在其他列显示但是十分重要的额外消息" class="headerlink" title="&ensp;&ensp;&ensp;包含不适合在其他列显示但是十分重要的额外消息."></a>&ensp;&ensp;&ensp;包含不适合在其他列显示但是十分重要的额外消息.</h5></li>
<li><p>Using index:    表示相应的select语句中使用了覆盖索引.</p>
</li>
<li>Using where:    表示MySQL服务器在存储引擎收到记录进行”后过滤”,如果查询未能使用索引,Using where只是提醒我们MySL将用where子句进行结果过滤.</li>
<li>Using temorary: 表示MySQL将使用临时表来存储结果集,常见于分组和排序查询.</li>
<li>Using filesort: MySQL将无法使用索引进行排序的的操作称为”file sort”.</li>
</ul>
<h3 id="MySQL执行计划的局限性"><a href="#MySQL执行计划的局限性" class="headerlink" title="MySQL执行计划的局限性"></a>MySQL执行计划的局限性</h3><ul>
<li>EXPLAIN不能解释触发器,存储过程或者用户自定义函数.</li>
<li>EXPLAIN不考虑CACHE对Query的影响.</li>
<li>EXPLAIN是基于统计信息的,统计信息并非准确值,有些估算的.</li>
<li>EXPLAIN只能解释SELECT语句,其他类型的Query需要重写为SELECT后查看.</li>
<li>EXPLAIN有时需要真实的执行某些SQL,线上操作需谨慎.    </li>
</ul>
<hr>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Darcy</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2014/06/12/MySQL-explain/">http://www.darcy.org.cn/2014/06/12/MySQL-explain/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>The author owns the copyright, please indicate the source reproduced</li></ul></div><br><div class="tags"><a href="/tags/MySQL/">MySQL</a><a href="/tags/优化/">优化</a></div><div class="post-nav"><a class="pre" href="/2014/06/23/mysqltong-ji-xin-xi/">MySQL统计信息</a><a class="next" href="/2014/06/10/mysql-shardingzai-gao-bing-fa-xia-de-quan-ju-idsheng-cheng/">MySQL sharding在高并发下的全局ID生成</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://www.darcy.org.cn"/></form></div><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="http://www.darcy.org.cn"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch/">Elasticsearch</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/优化/" style="font-size: 15px;">优化</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Tool/" style="font-size: 15px;">Tool</a> <a href="/tags/工具/" style="font-size: 15px;">工具</a> <a href="/tags/Thunderbird/" style="font-size: 15px;">Thunderbird</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/Shell/" style="font-size: 15px;">Shell</a> <a href="/tags/设计/" style="font-size: 15px;">设计</a> <a href="/tags/经验/" style="font-size: 15px;">经验</a> <a href="/tags/Elasticsearch/" style="font-size: 15px;">Elasticsearch</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/架构/" style="font-size: 15px;">架构</a> <a href="/tags/监控/" style="font-size: 15px;">监控</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/11/02/记一次Redis-Meet故障/">记一次Redis Meet故障</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/21/Redis高可用架构/">Redis高可用架构</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/11/Elasticsearch监控/">Elasticsearch监控</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/06/Elasticsearch部署优化/">Elasticsearch部署优化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/Redis-主从复制/">Redis主从复制</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/11/Redis-持久化/">Redis持久化</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/08/14/Redis中的used-memory与maxmemory解惑/">Redis中的used_memory与maxmemory解惑</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/07/20/thunderbird-jin-jie/">Thunderbird 进阶</a></li><li class="post-list-item"><a class="post-list-link" href="/2015/06/19/linuxxia-ru-he-an-quan-shan-chu-wen-jian/">Linux下如何安全删除文件</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/06/23/mysqltong-ji-xin-xi/">MySQL统计信息</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://chaubeau.lofter.com" title="chaubeau" target="_blank">chaubeau</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Darcy Blog</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>